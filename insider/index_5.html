<!DOCTYPE html>

<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="index.css">

    <script type="text/javascript" src="lib/jquery.min.js"></script>
    <script type="text/javascript" src="lib/osql.js"></script>
    <script type="text/javascript" src="settings.js"></script>

    <script>
        osql.requireLogin();
        //ルーム番号を表示
        var room = sessionStorage.getItem('room');
        document.getElementById('roomnum').innerHTML = room;
        var userid = sessionStorage.getItem('userid');

        let countupVal, updateVal;
        let count = 15;
        let countup = function () {
            count = count - 1;
            document.getElementById("timer").innerHTML = count;
            if (count == 0) {
                //画面遷移
                location.href = 'index_7.html';
            }
        }
        countupVal = setInterval(countup, 1000);

        display();


        async function display() {
            var sql = `select role from Roles where roomid="${room}" and userid="${userid}";`;
            var objects = await osql.connect(sql);
            console.log(objects);
            var role = objects[0]['role'];
            sessionStorage.setItem('role', role);
            document.getElementById('role').innerHTML = role;
        }
        //インサイダーとゲームマスターにだけお題
        if (role == "インサイダー" || role == "ゲームマスター") {
            displayTheme();
        }


        async function displayTheme() {
            var sql = `select theme from Rooms where id="${room}";`;
            var objects = await osql.connect(sql);
            console.log(objects);
            var themeNum = objects[0]['theme']

            var sql = `select theme from Themes where num="${themeNum}";`;
            var objects = await osql.connect(sql);
            console.log(objects[0]['theme']);

            document.getElementById('theme').innerHTML = objects[0]['theme'];
        }



    </script>
</head>

<body>
    <p>ルーム：
    <div class="room" id="roomnum"></div>
    </p>
    <p class="title">インサイダーゲーム</p>
    <p>あなたは<span id="role"></span>です</p>
    <p>お題は
        <span id="theme"></span>です
    </p>
    <input type="button" id="start" value="OK">
    <p>あと
        <span id="timer"></span>秒で遷移します
    </p>
</body>

</html>