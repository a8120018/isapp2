<!DOCTYPE html>

<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="index.css">

    <script type="text/javascript" src="lib/jquery.min.js"></script>
    <script type="text/javascript" src="lib/osql.js"></script>
    <script type="text/javascript" src="settings.js"></script>

    <script>
        osql.requireLogin();
        //ルーム作成が押されたら
        ducument.getElementByID('roombutton').addEventListener('click', async function makeRoom() {
            //ルーム番号を生成
            var room =
            //データベース登録
            var sql = `insert into Rooms (id, num, state, theme) values("${room}", "1", "受付中", "null");`;
            var objects = await osql.connect(sql);
            console.log(objects);
            //セッションストレージに入れる
            sessionStorage.setItem('room', room);
            //ページを４主催者用へ
            location.href = 'index_4.html';
        })
        //入室が押されたら
        ducument.getElementByID('enter').addEventListener('click', async function enterRoom() {
            var roomNum = document.getElementById('roomNum').value;

            var sql = `select * from Rooms where id="${roomNum}";`;
            var objects = await osql.connect(sql);
            console.log(objects);


            if (objects !== null && object[0].state == "受付中") {
                //ルーム番号roomNumをセッションストレージに入れる
                sessionStorage.setItem('room', roomNum);
                //データベース更新
                var sql = `update Rooms set num="${objects[0]['num'] + 1}"`;
                var objects = await osql.connect(sql);
                console.log(objects);
                //ページを４その他の人用に遷移
                location.href = 'index_4.html';
            } else {
                //エラー表示
                window.alert('ルームが存在しないか、受付終了しています')
            }
        })
    </script>

</head>

<body>
    <p class="title">インサイダーゲーム</p>
    <p>ルームを作成</p>
    <input type="button" id="roombutton" value="作成">
    <p>ルーム入室</p>
    <input type="text" id="roomNum" placeholder="ルーム番号">
    <input type="button" id="enter" value="入室">
</body>

</html>